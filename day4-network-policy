#lets create a namespace 
   255  kubectl create ns crm
  256  kubectl get ns crm
  #inside the namespace we will create two pod 
  257  kubectl -n crm run frontend --image=nginx
  258  kubectl -n crm run backend --image=nginx
  #we will expose this pod with service the default is cluster ip
  259  kubectl -n crm expose pod frontend --port=80
  260  kubectl -n crm expose pod backend --port=80
  261  kubectl -n crm get pod,svc
  #now if we test the connection between the pod service they are communicateion
  262  kubectl -n crm exec -it frontend -- curl backend
  263  kubectl -n crm exec -it backend -- curl frontend
  ##lets disable the communication
   265  nano default-deny.yml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny #this is the name of the network policy
  namespace: crm #in the crm namespace
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
  
  
  266  kubectl apply -f default-deny.yml
  #this will show the network policy
  268  kubectl -n crm get networkpolicy
    ####you get more detail about network policy
  269  kubectl -n crm describe networkpolicy
    #now if you try to send an curl request it will not work
  270  kubectl -n crm exec -it backend -- curl frontend
#lets create an egress policy where frontend can intiate connection to backend
 257  nano frontend-policy.yml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: frontend-policy #this is the name of the network policy
  namespace: crm #in the crm namespace
spec:
  podSelector: 
    matchLabels:
      run: frontend
  policyTypes:
  - Ingress
  - Egress
  egress: #frontend can intiate connections to backend pods
  - to:
    - podSelector:
        matchLabels:
          run: backend

  258  kubectl apply -f frontend-policy.yml
 #check a front end policy is created 
  260  kubectl -n crm get networkpolicy
#you can describe the same also
  262  kubectl -n crm describe networkpolicy frontend-policy
#we created a policy which will intiate connection from frontend backend 
[root@ip-172-31-93-226 ~]$ kubectl -n crm exec -it frontend -- curl backend
#while testing it is not working
